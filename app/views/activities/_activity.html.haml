%tr
  %td.name
    = link_to activity.name, troop_activity_path(@troop, activity)
    &nbsp;
    - if activity.created_at > Time.now - 7.days
      .badge.badge-primary NEW
    %br
    = render partial: 'activity_icons', locals: { activity: activity }
    - if activity.activity_icons?
      \|
    %span.text-muted
      = pluralize(activity.duration_days, 'day')
  %td.votes-count
    - if params[:admin]
      - if activity.is_archived?
        .badge.badge-info Archived
    - else
      = activity.votes_count || 0
  - if signed_in? && current_user.troop == @troop
    %td.vote
      - if params[:admin]
        = link_to "Edit", edit_troop_activity_path(@troop, activity)
      - else
        - if signed_in? && current_user.troop == @troop
          - if current_user.votes_available.positive?
            = button_to troop_votes_path(@troop, activity_id: activity.id), class: 'btn btn-primary' do
              = fa_icon "plus"
          - if current_user.votes.find_by(activity_id: activity.id)
            - vote = current_user.votes.find_by(activity_id: activity.id)
            = button_to troop_vote_path(@troop, vote), method: :delete, class: 'btn btn-primary' do
              = fa_icon "minus"
      %td.votes-count
        - unless params[:admin]
          - count = activity.votes.where(user: current_user).count
          = count || 0